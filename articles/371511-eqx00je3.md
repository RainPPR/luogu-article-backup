---
title: 题解：P11290 【MX-S6-T2】「KDOI-11」飞船
date: 1731827061
description: 设 fixy 表示从 i 个加油站离开时速度为 2x3y 的最小时间。

记 dipipi1 表示两个加油站之间的距离。

记 wdxydfracd2x3y 表示 xy 速度下走
author: 371511
---

设 $f(i,x,y)$ 表示从 $i$ 个加油站离开时速度为 $2^x3^y$ 的最小时间。

记 $d_i=p_i-p_{i-1}$ 表示两个加油站之间的距离。

记 $w(d,x,y)=\dfrac{d}{2^x3^y}$ 表示 $x,y$ 速度下走 $d$ 的时间。

转移易得：

$$
f(i,x,y)=\min\begin{cases}
f(i-1,x,y)+w(d_i,x,y)\\
f(i-1,x',y')+w(d_i,x',y')+t_i
\end{cases}
$$

其中 $x',y'$ 表示除去 $i$ 的加速后的速度，即加速前的速度。

注意到 $t_i\ge1$，当前的速度比跑道总长还大就可以直接跑过去。

飞船的速度只是 $10^9$ 级别的，因此第二维只需要记到 $30,19$ 就可以了。

时间复杂度 $\mathcal O(n\log^2 p)$，假定 $n,q$ 同阶、$p,y$ 同阶。结束了。

```cpp
constexpr int N = 1e5 + 10;
constexpr double INF = 1e9;

int n, q;

int X, Y;

struct node {
	int t, x, y;
} a[N];

int pos[N], del[N];

int d2[31], d3[20];

double dp[N][31][20];

double calc(int t) {
	int i = upper_bound(pos + 1, pos + n + 1, t) - pos - 1;
	double ans = t;
	for (int x = 0; x <= X; ++x)
		for (int y = 0; y <= Y; ++y)
			ans = min(ans, dp[i][x][y] + (double)(t - pos[i]) / (d2[x] * d3[y]));
	return ans;
}

void Main() {
	cin >> n >> q;
	for (int i = 1; i <= n; ++i) {
		int val;
		cin >> pos[i] >> a[i].t >> val;
		if (val == 1) {
			--n, --i;
			continue;
		}
		del[i] = pos[i] - pos[i - 1];
		a[i].x = (val % 2 == 0) * (val / 2);
		a[i].y = (val % 3 == 0);
		X += a[i].x, Y += a[i].y;
	}

	X = min(X, 30);
	Y = min(Y, 19);

	d2[0] = d3[0] = 1;
	for (int i = 1; i <= X; ++i)
		d2[i] = d2[i - 1] * 2;
	for (int i = 1; i <= Y; ++i)
		d3[i] = d3[i - 1] * 3;
	
	for (int i = 0; i <= n; ++i)
		for (int x = 0; x <= X; ++x)
			for (int y = 0; y <= Y; ++y)
				dp[i][x][y] = 1e9;

	dp[0][0][0] = 0;
	for (int i = 1; i <= n; ++i)
		for (int x = 0; x <= X; ++x)
			for (int y = 0; y <= Y; ++y) {
				dp[i][x][y] = min(INF, dp[i - 1][x][y] + (double)del[i] / (d2[x] * d3[y]));
				if (x >= a[i].x && y >= a[i].y)
					dp[i][x][y] = min(dp[i][x][y], dp[i - 1][x - a[i].x][y - a[i].y] + (double)del[i] / (d2[x - a[i].x] * d3[y - a[i].y]) + a[i].t);
			}

	while (q--) {
		int x;
		cin >> x;
		printf("%.20lf\n", calc(x));
	}
	return;
}
```

注意：

+ `float` 可能会被卡精度。

+ 数组如果开大了会 MLE / RE 在 MXOJ 会爆零。

+ 记忆化搜索可能会被卡常。
