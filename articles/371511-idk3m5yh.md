---
title: 题解：P11323 【MX-S7-T1】「SMOI-R2」Happy Card
date: 1732432501
description: b'57uT6K666aKY44CCCgoqKue7k+iuuuS4gCoq77ya5a+55LqO5Lu75oSPICR2X2k9M2NfaStyLCgwXGxlIHI8Mykk77yM5bCGICR2X2kkIOaLhuS4uiAkY19pJCDkuKogJDMkIOWSjOS4gOS4qiAkciQg5LiN5b2x5ZON562U5qGI44CCCgror4HmmI7vvJoKCisg5a+55LqO5Y2V77ya5pi+54S25LiN5b2x5ZON44CCCgorIOWvueS6juWvue+8muaYvueEtuS4jeW9seWTjeOAggoKKyDlr7nkuo7kuInluKbkuIDvvJrms6jmhI/liLDov5nkuKo='
author: 371511
---

结论题。

**结论一**：对于任意 $v_i=3c_i+r,(0\le r<3)$，将 $v_i$ 拆为 $c_i$ 个 $3$ 和一个 $r$ 不影响答案。

证明：

+ 对于单：显然不影响。

+ 对于对：显然不影响。

+ 对于三带一：注意到这个拆分的过程本质就是一个三带一的过程。

+ 对于炸：注意到一个 $\texttt A$ 的炸等价于三个 $\texttt A$ 带一个 $\texttt A$，因此是正确的。

因此，我们可以将问题全部转化为 $v_i\le3$ 的情况，不考虑炸的情况。

**结论二**：对于 $v_i\in\{1,2,3\}$ 按照如下操作，一定最优：

1. 尽可能多的用一个 $3$ 带走一个 $1$。

2. 尽可能多的用两个 $3$ 带走一个 $2$。

3. 尽可能多的用一个 $3$ 将一个 $2$ 转化为一个 $1$。

4. 注意到此时，要么剩下的都是 $3$ 要么不剩下 $3$。

   1. 如果不剩下 $3$，每个 $1,2$ 按照 $1$ 的系数拿走即可。
  
   2. 如果只剩下 $3$，按照如下策略：
  
5. 对于四个 $3$，令其中三个一次消去另外一个，即每消去 $4$ 个需要 $3$ 步。

6. 对于剩下的 $0,1,2,3$ 个三，容易知道只需要分别 $0,2,2,3$ 步即可。

核心代码：

```
int cnt3[4] = {0, 2, 2, 3};

int calc(int cnt) {
	return 3 * (cnt / 4) + cnt3[cnt % 4];
}

int solve(int *cnt) {
	int res = 0;

	// 用 3 把 1 消去
	int v31 = min(cnt[3], cnt[1]);
	cnt[3] -= v31;
	cnt[1] -= v31;
	res += v31;

	// 用两个 3 把 2 消去
	int v32 = min(cnt[3] >> 1, cnt[2]);
	cnt[3] -= v32 << 1;
	cnt[2] -= v32;
	res += v32 << 1;

	// 剩余的 3 把 2 消成 1 一个
	int v33 = min(cnt[3], cnt[2]);
	cnt[3] -= v33;
	cnt[2] -= v33;
	cnt[1] += v33;
	res += v33;

	// 对于 1 和 2 直接消去 3 特殊处理
	res += cnt[1] + cnt[2] + calc(cnt[3]);
	return res;
}

void Main() {
	int T = read<int>();
	while (T--) {
		int cnt[5] = {0};
		int n = read<int>();
		for (int i = 1; i <= n; ++i) {
			int x = read<int>();
			++cnt[x % 3];
			cnt[3] += x / 3;
		}
		writeln(solve(cnt));
	}
	return;
}
```
